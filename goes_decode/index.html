<!doctype html>


<head>
    <meta charset="utf-8">
    <title>Pseudobinary Decoder</title>
    
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body {
            margin: auto;
            max-width: 800px;
            padding-left: 20px;
            padding-right: 20px;
        }
    </style>

    <script>
        const print = msg => console.log(msg)

        const get_num = (id, default_val) => {
            let num = document.getElementById(id).value
            if (num === "") {
                num = default_val
            } else {
                num = Number(num)
            }
            return num
        }

        // Get Values
        const get_vals = () => {
            let msg = document.getElementById("e_msg").value
            let start = get_num("msg_start", 0)
            let end = get_num("msg_end", msg.length)
            let divider = get_num("div", 1)
            let multiplier = get_num("mul", 1)
            let adder = get_num("add", 1)

            return [msg, start, end, divider, multiplier, adder]
        }

        // Decode
        const decode = () => {
            let msg, start, end, divider, multiplier, adder
            [msg, start, end, divider, multiplier, adder] = get_vals()
            let decoded_value = decode_pseudobinary(msg.slice(start, end))
            let ans = adder + decoded_value * multiplier / divider
            set_vals(msg, decoded_value, ans)
        }

        const set_vals = (msg, decoded_value, ans) => {
            let encoded_o = document.getElementById("encoded_output")
            encoded_o.textContent = `Encoded Message: ${msg}`

            let decoded_o = document.getElementById("decoded_output")
            decoded_o.textContent = `Raw Decoded Message: ${decoded_value}`

            let ans_o = document.getElementById("decoded_ans")
            ans_o.textContent = `Processed Decoded Message: ${ans}`
        }
        const pad = (num, size) => {
            num = num.toString();
            while (num.length < size) {
                num = "0" + num
            }
            return num;
        }

        const decode_pseudobinary = encoded_data => {
            let binary_value, binary_value_arr, decimal_value, decoded_value, intermediate_str;
            binary_value_arr = [];

            for (let i = 0; i < encoded_data.length; i++) {
                let chr = encoded_data.charAt(i)

                if (chr === "?") {
                    binary_value = "111111";
                } else {
                    decimal_value = chr.charCodeAt(0)
                    binary_value = pad((decimal_value - 64).toString(2), 6);
                }

                binary_value_arr.push(binary_value);
            }

            intermediate_str = binary_value_arr.join("");

            decoded_value = Number.parseInt(intermediate_str, 2);

            return Number(decoded_value);
        }
    </script>
</head>

<body>
<h1>
    GOES Decoder
</h1>
<form name="msg_data" action="javascript:decode()">
    <label for="e_msg">Encoded Message:</label><br>
    <input type="text" id="e_msg" value="`BST@Ff@Ffj "><br>
    <label for="msg_start">Start</label><br>
    <input type="number" id="msg_start" value="4"><br>
    <label for="msg_end">End</label><br>
    <input type="number" id="msg_end" value="7"><br>
    <label for="div">Divider</label><br>
    <input type="number" id="div" step="0.01" value="1"><br>
    <label for="mul">Multiplier</label><br>
    <input type="number" id="mul" step="0.01" value="1"><br>
    <label for="add">Adder</label><br>
    <input type="number" id="add" step="0.01" value="0"><br><br>
    <input name="Submit" type="submit" value="Decode"/>
</form>
<div>
    <p id="encoded_output"></p>
    <p id="decoded_output"></p>
    <p id="decoded_ans"></p>
</div>
</body>

</html>
